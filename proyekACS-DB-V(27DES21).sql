DROP TABLE KARYAWAN CASCADE CONSTRAINTS PURGE;
DROP TABLE SUPPLIER CASCADE CONSTRAINTS PURGE; 
DROP TABLE BARANG CASCADE CONSTRAINTS PURGE;
DROP TABLE RBARANG CASCADE CONSTRAINTS PURGE; 
DROP TABLE HPEMBELIAN CASCADE CONSTRAINTS PURGE; 
DROP TABLE DPEMBELIAN CASCADE CONSTRAINTS PURGE;
DROP TABLE HRETUR CASCADE CONSTRAINTS PURGE;
DROP TABLE DRETUR CASCADE CONSTRAINTS PURGE;
DROP TABLE HPEMBAYARAN CASCADE CONSTRAINTS PURGE; 
DROP TABLE DPEMBAYARAN CASCADE CONSTRAINTS PURGE;


CREATE TABLE KARYAWAN
(
	ID_KARYAWAN INT PRIMARY KEY,
	USERNAME VARCHAR2(20) ,
	PASSWORD VARCHAR2(20) , 
	JABATAN INT ,
	STATUS INT
);

CREATE TABLE SUPPLIER
(
	ID_SUPPLIER INT PRIMARY KEY,
	NAMA VARCHAR2(20) , 
	KONTAK VARCHAR2(20) ,
	ALAMAT VARCHAR2(20) ,
	METODE_PEMBAYARAN VARCHAR2(20)
);

CREATE TABLE BARANG
(
	ID INT  PRIMARY KEY,
	NAMA VARCHAR2(20) ,
	STOK INT ,
	HARGA INT
);

CREATE TABLE RBARANG
(
	ID_SUPPLIER INT REFERENCES SUPPLIER,
	ID_BARANG INT REFERENCES BARANG
);

CREATE TABLE HPEMBELIAN
(
	NOMOR_NOTA VARCHAR2(20) PRIMARY KEY,
	TANGGAL DATE, 
	ID_SUPPLIER INT REFERENCES SUPPLIER,
	TOTAL INT ,
	STATUS_PENGIRIMAN INT
);

CREATE TABLE DPEMBELIAN
(
	NOMOR_NOTA VARCHAR2(20) REFERENCES HPEMBELIAN,
	ID_BARANG INT REFERENCES BARANG(ID),
	HARGA INT,
	QTY INT , 
	SUBTOTAL INT 
);

CREATE TABLE HRETUR
(
	NOMOR_RETUR VARCHAR2(20)  PRIMARY KEY,
	NOMOR_NOTA VARCHAR2(20) REFERENCES HPEMBELIAN,
	TANGGAL DATE ,
	ID_SUPPLIER INT REFERENCES SUPPLIER
);

CREATE TABLE DRETUR
(
	NOMOR_RETUR VARCHAR2(20) REFERENCES HRETUR,
	ID_BARANG INT REFERENCES BARANG,
	QTY INT ,
	DETAIL VARCHAR2(50) 
);

-- CREATE TABLE HPEMBAYARAN
-- (
-- 	ID_PEMBAYARAN VARCHAR2(20) PRIMARY KEY,
-- 	ID_SUPPLIER INT REFERENCES SUPPLIER,
-- 	TOTAL INT,
-- 	JATUH_TEMPO DATE
-- );

CREATE TABLE DPEMBAYARAN
(
	ID_PEMBAYARAN VARCHAR2(20) PRIMARY KEY,
	NOMOR_NOTA VARCHAR2(20) REFERENCES HPEMBELIAN,
	ID_SUPPLIER INT REFERENCES SUPPLIER,
	TOTAL INT,
	STATUS INT
);

--Karyawan 
INSERT INTO KARYAWAN VALUES(1, 'jojo', 'jojo', 1, 1); --Pembelian
INSERT INTO KARYAWAN VALUES(2, 'calvin' , 'calvin', 2 , 1); --retur
INSERT INTO KARYAWAN VALUES(3, 'edward', 'edward', 3, 1); --pembayaran
INSERT INTO KARYAWAN VALUES(4, 'timoty', 'timoty', 99, 1); --admin
INSERT INTO KARYAWAN VALUES(5, 'kevin', 'kevin', 1, 0);
INSERT INTO KARYAWAN VALUES(6, 'ester', 'ester', 2, 0);

-- SUPPLIER
INSERT INTO SUPPLIER VALUES(1, 'kungkang', 'kungkang@gmail.com', 'jalan planet bumi', 'Cash');
INSERT INTO SUPPLIER VALUES(2, 'axel', 'axel@gmail.com', 'jalan planet mars', 'Transfer');
INSERT INTO SUPPLIER VALUES(3, 'kriswanto', 'kriswanto@gmail.com', 'jalan sejahtera', 'Credit');

--BARANG
INSERT INTO BARANG VALUES(1, 'baju', 10, 1000);
INSERT INTO BARANG VALUES(2, 'celana', 5, 2000);
INSERT INTO BARANG VALUES(3, 'sepatu', 15, 3000);

--RBARANG
INSERT INTO RBARANG VALUES(1,1);
INSERT INTO RBARANG VALUES(2,2);
INSERT INTO RBARANG VALUES(3,3);

--HPEMBELIAN
INSERT INTO HPEMBELIAN VALUES('BELI14052021001',TO_DATE('14-05-2021', 'DD-MM-YYYY'), 1, 2000, 0 );
INSERT INTO HPEMBELIAN VALUES('BELI14062021001',TO_DATE('14-06-2021', 'DD-MM-YYYY'), 2, 4000, 1 );
INSERT INTO HPEMBELIAN VALUES('BELI14072021001', TO_DATE('14-07-2021', 'DD-MM-YYYY'), 3, 9000, 2);

--DPEMBELIAN
INSERT INTO DPEMBELIAN VALUES ('BELI14052021001', 1, 1000 , 2, 2000 );
INSERT INTO DPEMBELIAN VALUES ('BELI14062021001', 2 , 2000 , 2 , 4000);
INSERT INTO DPEMBELIAN VALUES ('BELI14072021001', 3 , 3000, 3 , 9000);

--HRETUR
INSERT INTO HRETUR VALUES('RETUR20062021001','BELI14052021001', TO_DATE('20-06-2021', 'DD-MM-YYYY'), 1);
INSERT INTO HRETUR VALUES('RETUR23062021001','BELI14062021001', TO_DATE('23-06-2021', 'DD-MM-YYYY'), 2);
INSERT INTO HRETUR VALUES('RETUR28062021001','BELI14072021001', TO_DATE('28-06-2021', 'DD-MM-YYYY'), 3);

--DRETUR
INSERT INTO DRETUR VALUES('RETUR20062021001', 1 , 1 , 'baju nya sobek'); 
INSERT INTO DRETUR VALUES('RETUR23062021001', 2, 1, 'celana nya kekecilan');
INSERT INTO DRETUR VALUES('RETUR28062021001', 3 , 1, 'sepatu e cacatttttt blok');

--HPEMBAYARAN
-- INSERT INTO HPEMBAYARAN VALUES(1, 1, 2000, TO_DATE('10-12-2021','DD-MM-YYYY'));
-- INSERT INTO HPEMBAYARAN VALUES(2, 2, 4000, TO_DATE('10-12-2021','DD-MM-YYYY'));
-- INSERT INTO HPEMBAYARAN VALUES(3, 3, 9000, TO_DATE('10-12-2021','DD-MM-YYYY'));

--DPEMBAYARAn

INSERT INTO DPEMBAYARAN VALUES(1, 'BELI14052021001',1, 2000,1);
INSERT INTO DPEMBAYARAN VALUES(2, 'BELI14062021001',2, 4000,1);
INSERT INTO DPEMBAYARAN VALUES(3, 'BELI14072021001',2, 9000,0);

COMMIT;



--untuk membuat nota ngabs

CREATE OR REPLACE FUNCTION GenerateNomorNota(
	input varchar2
)
RETURN VARCHAR2
IS
    count_data NUMBER;
    prefix VARCHAR2(255);
	nama varchar2(255);

BEGIN 
	
    prefix := 'BELI' || input;

    select count(*)+1 into count_data from HPEMBELIAN where NOMOR_NOTA like '%' || prefix || '%';

    RETURN prefix || TO_CHAR(count_data, 'FM009');
END;
/
show err;


--untuk membuat nota retur

CREATE OR REPLACE FUNCTION GenerateNomorRetur
RETURN VARCHAR2
IS
    count_data NUMBER;
    prefix VARCHAR2(255);
	nama varchar2(255);
BEGIN 
    prefix := 'RETUR' || TO_CHAR(sysdate,'DD') || TO_CHAR(sysdate, 'MM') || TO_CHAR(sysdate, 'YYYY');
    select count(*)+1 into count_data from hretur where NOMOR_RETUR like '%' || prefix || '%';
    RETURN prefix || TO_CHAR(count_data, 'FM009');
END;
/
show err;
select GenerateNomorRetur() from dual;